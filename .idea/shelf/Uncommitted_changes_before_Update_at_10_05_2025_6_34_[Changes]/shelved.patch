Index: server.py
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+># server.py\r\nfrom bottle import route, run, request, post, static_file, template, redirect, hook\r\nimport database\r\n\r\ndatabase.init_db()\r\n\r\n@route('/')\r\ndef hello():\r\n    return \"Пыщ!\"\r\n\r\n@post('/echo')\r\ndef echo():\r\n    return 'You sent: ' + request.body.read().decode('utf-8')\r\n\r\n@route('/static/<filename:path>')   # Статические файлы (CSS, JS) style.css\r\ndef serve_static(filename):\r\n    return static_file(filename, root='./static')\r\n\r\n\r\n@hook('before_request')\r\ndef strip_trailing_slash():\r\n    \"\"\"Удаляет слеши в конце URL перед обработкой запроса\"\"\"\r\n    original_path = request.path\r\n    # Исключаем специальные роуты (например, /raw/)\r\n    if not original_path.endswith('/raw/') and original_path != '/':\r\n        while original_path.endswith('/'):\r\n            original_path = original_path[:-1]\r\n\r\n        if original_path != request.path:\r\n            redirect(original_path)\r\n\r\n\r\n@route('/astral', method=['GET', 'POST'])\r\ndef astral():\r\n    if request.method == 'POST':\r\n        client_name = request.forms.getunicode('client_name', '').strip()   # Используем getunicode вместо get\r\n\r\n        if not client_name:\r\n            return template('astral', error=\"Имя клиента не может быть пустым\")\r\n\r\n        result = database.astral_client_creation(client_name)\r\n\r\n        if result['status'] == 'success':\r\n            return redirect(f\"/astral/{client_name}\")\r\n        else:\r\n            return template('astral', error=result['message'])\r\n\r\n    return template('astral')\r\n\r\n\r\n# Удаление клиента\r\n@route('/astral/<client_name>/action/delete', method=['POST'])\r\ndef delete_client_route(client_name):\r\n    result = database.delete_client(client_name)\r\n    if result['status'] == 'success':\r\n        return redirect(\"/astral\")\r\n    return template('astral', error=result.get('message'))\r\n\r\n# Удаление проекта\r\n@route('/astral/<client_name>/<project_name>/action/delete', method=['POST'])\r\ndef delete_project_route(client_name, project_name):\r\n    result = database.delete_project(client_name, project_name)\r\n    if result['status'] == 'success':\r\n        return redirect(f\"/astral/{client_name}\")\r\n    projects = database.get_client_projects(client_name)\r\n    return template('client', client_name=client_name,\r\n                   projects=projects, error=result.get('message'))\r\n\r\n# Удаление скрипта\r\n@route('/astral/<client_name>/<project_name>/<script_name>/action/delete', method=['POST'])\r\ndef delete_script_route(client_name, project_name, script_name):\r\n    result = database.delete_script(client_name, project_name, script_name)\r\n    if result['status'] == 'success':\r\n        return redirect(f\"/astral/{client_name}/{project_name}\")\r\n    scripts = database.get_project_scripts(client_name, project_name)\r\n    return template('project', client_name=client_name,\r\n                   project_name=project_name, scripts=scripts,\r\n                   error=result.get('message'))\r\n\r\n\r\n@route('/astral/<client_name>', method=['GET', 'POST'])\r\ndef client_page(client_name):\r\n    if request.method == 'POST':\r\n        project_name = request.forms.getunicode('project_name', '').strip()\r\n\r\n        if not project_name:\r\n            projects = database.get_client_projects(client_name)\r\n            return template('client',\r\n                            client_name=client_name,\r\n                            projects=projects,\r\n                            error=\"Имя проекта не может быть пустым\")\r\n\r\n        result = database.astral_project_creation(client_name, project_name)\r\n\r\n        if result['status'] == 'success':\r\n            return redirect(f\"/astral/{client_name}/{project_name}\")\r\n        else:\r\n            projects = database.get_client_projects(client_name)\r\n            return template('client',\r\n                            client_name=client_name,\r\n                            projects=projects,\r\n                            error=result['message'])\r\n\r\n    projects = database.get_client_projects(client_name)\r\n    if projects is None:\r\n        return \"Клиент не найден\"\r\n\r\n    return template('client',\r\n                    client_name=client_name,\r\n                    projects=projects,\r\n                    error=None)\r\n\r\n\r\n@route('/astral/<client_name>/<project_name>', method=['GET', 'POST'])\r\ndef project_page(client_name, project_name):\r\n    if request.method == 'POST':\r\n        script_name = request.forms.getunicode('script_name', '').strip()\r\n\r\n        if not script_name:\r\n            scripts = database.get_project_scripts(client_name, project_name)\r\n            return template('project',\r\n                            client_name=client_name,\r\n                            project_name=project_name,\r\n                            scripts=scripts,\r\n                            error=\"Имя скрипта не может быть пустым\")\r\n\r\n        result = database.astral_script_creation(client_name, project_name, script_name)\r\n\r\n        if result['status'] == 'success':\r\n            return redirect(f\"/astral/{client_name}/{project_name}/{script_name}\")\r\n        else:\r\n            scripts = database.get_project_scripts(client_name, project_name)\r\n            return template('project',\r\n                            client_name=client_name,\r\n                            project_name=project_name,\r\n                            scripts=scripts,\r\n                            error=result['message'])\r\n\r\n    scripts = database.get_project_scripts(client_name, project_name)\r\n    if scripts is None:\r\n        return \"Проект не найден\"\r\n\r\n    return template('project',\r\n                    client_name=client_name,\r\n                    project_name=project_name,\r\n                    scripts=scripts,\r\n                    error=None)\r\n\r\n\r\n@route('/astral/<client_name>/<project_name>/<script_name>', method=['GET', 'POST'])\r\ndef script_page(client_name, project_name, script_name):\r\n    if request.method == 'POST':\r\n        if 'save' in request.forms:\r\n            script_data = request.forms.getunicode('script_data', '')\r\n            result = database.save_script_data(client_name, project_name, script_name, script_data)\r\n\r\n            current_data = database.get_script_data(client_name, project_name, script_name)\r\n            return template('script',\r\n                            client_name=client_name,\r\n                            project_name=project_name,\r\n                            script_name=script_name,\r\n                            script_data=current_data,\r\n                            message=\"Сохранено успешно\" if result['status'] == 'success' else result['message'])\r\n        else:\r\n            # Перезагрузка страницы\r\n            pass\r\n\r\n    script_data = database.get_script_data(client_name, project_name, script_name)\r\n    if script_data is None:\r\n        return \"Скрипт не найден\"\r\n\r\n    return template('script',\r\n                    client_name=client_name,\r\n                    project_name=project_name,\r\n                    script_name=script_name,\r\n                    script_data=script_data,\r\n                    message=None)\r\n\r\n\r\n# Raw доступ к скрипту\r\n@route('/astral/<client_name>/<project_name>/<script_name>/raw', method=['GET', 'POST'])\r\ndef script_raw(client_name, project_name, script_name):\r\n    script_data = database.get_script_data(client_name, project_name, script_name) or \"\"\r\n\r\n    if request.method == 'POST':\r\n        # Только raw data (быстро и без лишних проверок)\r\n        raw_data = request.body.read()\r\n        try:\r\n            new_data = raw_data.decode('utf-8')\r\n        except UnicodeDecodeError:\r\n            new_data = raw_data.decode('latin-1')\r\n\r\n        result = database.save_script_data(client_name, project_name, script_name, new_data)\r\n        return \"true\" if result['status'] == 'success' else \"\"\r\n\r\n    return script_data\r\n\r\n\r\nrun(host='127.0.0.1', port=8000)
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/server.py b/server.py
--- a/server.py	(revision ef5f7089f00ac9b3174b3cc7c367eb442eb1a934)
+++ b/server.py	(date 1746824178773)
@@ -196,4 +196,5 @@
     return script_data
 
 
-run(host='127.0.0.1', port=8000)
\ No newline at end of file
+#run(host='127.0.0.1', port=8000)
+run(host='0.0.0.0', port=8000)
\ No newline at end of file
Index: .idea/workspace.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<project version=\"4\">\r\n  <component name=\"AutoImportSettings\">\r\n    <option name=\"autoReloadType\" value=\"SELECTIVE\" />\r\n  </component>\r\n  <component name=\"ChangeListManager\">\r\n    <list default=\"true\" id=\"3386ae90-cea5-4770-b3b4-9cba0b1c67f5\" name=\"Changes\" comment=\"raw_data.decode('utf-8')\">\r\n      <change afterPath=\"$PROJECT_DIR$/lua/execute_server_var1.lua\" afterDir=\"false\" />\r\n      <change afterPath=\"$PROJECT_DIR$/lua/execute_server_var2.lua\" afterDir=\"false\" />\r\n      <change afterPath=\"$PROJECT_DIR$/lua/execute_server_var3.lua\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/.idea/workspace.xml\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/.idea/workspace.xml\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/astral.db\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/astral.db\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/server.py\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/server.py\" afterDir=\"false\" />\r\n    </list>\r\n    <option name=\"SHOW_DIALOG\" value=\"false\" />\r\n    <option name=\"HIGHLIGHT_CONFLICTS\" value=\"true\" />\r\n    <option name=\"HIGHLIGHT_NON_ACTIVE_CHANGELIST\" value=\"false\" />\r\n    <option name=\"LAST_RESOLUTION\" value=\"IGNORE\" />\r\n  </component>\r\n  <component name=\"Git.Settings\">\r\n    <option name=\"RECENT_GIT_ROOT_PATH\" value=\"$PROJECT_DIR$\" />\r\n    <option name=\"UPDATE_TYPE\" value=\"REBASE\" />\r\n  </component>\r\n  <component name=\"GitHubPullRequestSearchHistory\">{\r\n  &quot;lastFilter&quot;: {\r\n    &quot;state&quot;: &quot;OPEN&quot;,\r\n    &quot;assignee&quot;: &quot;wedro22&quot;\r\n  }\r\n}</component>\r\n  <component name=\"GithubPullRequestsUISettings\">{\r\n  &quot;selectedUrlAndAccountId&quot;: {\r\n    &quot;url&quot;: &quot;https://github.com/wedro22/AstralServer.git&quot;,\r\n    &quot;accountId&quot;: &quot;8ef9aeca-5aa5-4261-88ac-b1976ed39c3b&quot;\r\n  }\r\n}</component>\r\n  <component name=\"ProjectColorInfo\">{\r\n  &quot;associatedIndex&quot;: 4\r\n}</component>\r\n  <component name=\"ProjectId\" id=\"2wXdzawlm6dYE7qVBCMrccQYEmh\" />\r\n  <component name=\"ProjectViewState\">\r\n    <option name=\"hideEmptyMiddlePackages\" value=\"true\" />\r\n    <option name=\"showLibraryContents\" value=\"true\" />\r\n  </component>\r\n  <component name=\"PropertiesComponent\">{\r\n  &quot;keyToString&quot;: {\r\n    &quot;ModuleVcsDetector.initialDetectionPerformed&quot;: &quot;true&quot;,\r\n    &quot;Python.astral_page.executor&quot;: &quot;Run&quot;,\r\n    &quot;Python.database.executor&quot;: &quot;Run&quot;,\r\n    &quot;Python.main.executor&quot;: &quot;Run&quot;,\r\n    &quot;Python.nicegui_client.executor&quot;: &quot;Run&quot;,\r\n    &quot;Python.server.executor&quot;: &quot;Run&quot;,\r\n    &quot;Python.textual_client.executor&quot;: &quot;Run&quot;,\r\n    &quot;RunOnceActivity.ShowReadmeOnStart&quot;: &quot;true&quot;,\r\n    &quot;RunOnceActivity.git.unshallow&quot;: &quot;true&quot;,\r\n    &quot;git-widget-placeholder&quot;: &quot;master&quot;,\r\n    &quot;ignore.virus.scanning.warn.message&quot;: &quot;true&quot;,\r\n    &quot;last_opened_file_path&quot;: &quot;C:/Users/user/PycharmProjects/PythonProject/lua&quot;,\r\n    &quot;settings.editor.selected.configurable&quot;: &quot;preferences.pluginManager&quot;\r\n  }\r\n}</component>\r\n  <component name=\"RecentsManager\">\r\n    <key name=\"CopyFile.RECENT_KEYS\">\r\n      <recent name=\"C:\\Users\\user\\PycharmProjects\\PythonProject\\lua\" />\r\n    </key>\r\n  </component>\r\n  <component name=\"SharedIndexes\">\r\n    <attachedChunks>\r\n      <set>\r\n        <option value=\"bundled-python-sdk-348a24fa61fa-5312c7369657-com.jetbrains.pycharm.community.sharedIndexes.bundled-PC-251.23774.444\" />\r\n      </set>\r\n    </attachedChunks>\r\n  </component>\r\n  <component name=\"SpellCheckerSettings\" RuntimeDictionaries=\"0\" Folders=\"0\" CustomDictionaries=\"0\" DefaultDictionary=\"application-level\" UseSingleDictionary=\"true\" transferred=\"true\" />\r\n  <component name=\"TaskManager\">\r\n    <task active=\"true\" id=\"Default\" summary=\"Default task\">\r\n      <changelist id=\"3386ae90-cea5-4770-b3b4-9cba0b1c67f5\" name=\"Changes\" comment=\"\" />\r\n      <created>1746192116071</created>\r\n      <option name=\"number\" value=\"Default\" />\r\n      <option name=\"presentableId\" value=\"Default\" />\r\n      <updated>1746192116071</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00001\" summary=\"db\">\r\n      <option name=\"closed\" value=\"true\" />\r\n      <created>1746364705763</created>\r\n      <option name=\"number\" value=\"00001\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00001\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1746364705763</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00002\" summary=\"db\">\r\n      <option name=\"closed\" value=\"true\" />\r\n      <created>1746377529282</created>\r\n      <option name=\"number\" value=\"00002\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00002\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1746377529282</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00003\" summary=\"db client/project/script\">\r\n      <option name=\"closed\" value=\"true\" />\r\n      <created>1746691715766</created>\r\n      <option name=\"number\" value=\"00003\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00003\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1746691715766</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00004\" summary=\"raw script? delete?\">\r\n      <option name=\"closed\" value=\"true\" />\r\n      <created>1746734723466</created>\r\n      <option name=\"number\" value=\"00004\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00004\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1746734723466</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00005\" summary=\"raw script? delete\">\r\n      <option name=\"closed\" value=\"true\" />\r\n      <created>1746739445724</created>\r\n      <option name=\"number\" value=\"00005\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00005\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1746739445724</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00006\" summary=\"raw &amp; server lua\">\r\n      <option name=\"closed\" value=\"true\" />\r\n      <created>1746791606159</created>\r\n      <option name=\"number\" value=\"00006\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00006\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1746791606159</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00007\" summary=\"raw_data.decode('utf-8')\">\r\n      <option name=\"closed\" value=\"true\" />\r\n      <created>1746807431588</created>\r\n      <option name=\"number\" value=\"00007\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00007\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1746807431588</updated>\r\n    </task>\r\n    <option name=\"localTasksCounter\" value=\"8\" />\r\n    <servers />\r\n  </component>\r\n  <component name=\"UnknownFeatures\">\r\n    <option featureType=\"com.intellij.fileTypeFactory\" implementationName=\"*.lua\" />\r\n  </component>\r\n  <component name=\"VcsManagerConfiguration\">\r\n    <MESSAGE value=\"db\" />\r\n    <MESSAGE value=\"db client/project/script\" />\r\n    <MESSAGE value=\"raw script? delete?\" />\r\n    <MESSAGE value=\"raw script? delete\" />\r\n    <MESSAGE value=\"raw &amp; server lua\" />\r\n    <MESSAGE value=\"raw_data.decode('utf-8')\" />\r\n    <option name=\"LAST_COMMIT_MESSAGE\" value=\"raw_data.decode('utf-8')\" />\r\n  </component>\r\n</project>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/.idea/workspace.xml b/.idea/workspace.xml
--- a/.idea/workspace.xml	(revision ef5f7089f00ac9b3174b3cc7c367eb442eb1a934)
+++ b/.idea/workspace.xml	(date 1746824181354)
@@ -4,10 +4,7 @@
     <option name="autoReloadType" value="SELECTIVE" />
   </component>
   <component name="ChangeListManager">
-    <list default="true" id="3386ae90-cea5-4770-b3b4-9cba0b1c67f5" name="Changes" comment="raw_data.decode('utf-8')">
-      <change afterPath="$PROJECT_DIR$/lua/execute_server_var1.lua" afterDir="false" />
-      <change afterPath="$PROJECT_DIR$/lua/execute_server_var2.lua" afterDir="false" />
-      <change afterPath="$PROJECT_DIR$/lua/execute_server_var3.lua" afterDir="false" />
+    <list default="true" id="3386ae90-cea5-4770-b3b4-9cba0b1c67f5" name="Changes" comment="execute_servers?">
       <change beforePath="$PROJECT_DIR$/.idea/workspace.xml" beforeDir="false" afterPath="$PROJECT_DIR$/.idea/workspace.xml" afterDir="false" />
       <change beforePath="$PROJECT_DIR$/astral.db" beforeDir="false" afterPath="$PROJECT_DIR$/astral.db" afterDir="false" />
       <change beforePath="$PROJECT_DIR$/server.py" beforeDir="false" afterPath="$PROJECT_DIR$/server.py" afterDir="false" />
@@ -135,7 +132,15 @@
       <option name="project" value="LOCAL" />
       <updated>1746807431588</updated>
     </task>
-    <option name="localTasksCounter" value="8" />
+    <task id="LOCAL-00008" summary="execute_servers?">
+      <option name="closed" value="true" />
+      <created>1746813907943</created>
+      <option name="number" value="00008" />
+      <option name="presentableId" value="LOCAL-00008" />
+      <option name="project" value="LOCAL" />
+      <updated>1746813907943</updated>
+    </task>
+    <option name="localTasksCounter" value="9" />
     <servers />
   </component>
   <component name="UnknownFeatures">
@@ -148,6 +153,7 @@
     <MESSAGE value="raw script? delete" />
     <MESSAGE value="raw &amp; server lua" />
     <MESSAGE value="raw_data.decode('utf-8')" />
-    <option name="LAST_COMMIT_MESSAGE" value="raw_data.decode('utf-8')" />
+    <MESSAGE value="execute_servers?" />
+    <option name="LAST_COMMIT_MESSAGE" value="execute_servers?" />
   </component>
 </project>
\ No newline at end of file
